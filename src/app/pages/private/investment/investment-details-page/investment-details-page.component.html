<app-page-wrapper
  *ngIf="investment() as investment"
  [title]="investment.title"
  backTo="/investment"
>
  <app-page-wrapper-actions>
    <a class="button" [routerLink]="['.', 'position-add']">+</a>
  </app-page-wrapper-actions>

  <div class="flex flex-col gap-4">
    <div class="flex flex-col">
      <div class="flex gap-1">
        <label for="value">Initial:</label>
        <div id="value" class="bg-[#0000FF]">
          {{ investment.value | currency }}
        </div>
      </div>
      <div class="flex gap-1">
        <label for="netInterestAverage">Gross:</label>
        <div class="bg-[#FFA500]">
          {{ totals().grossValue | currency }}
          <small>
            ({{ totals().gross | currency }} -
            {{ totals().grossPercentage | percent : ".1-3" }})</small
          >
        </div>
      </div>
      <div class="flex gap-1">
        <label for="netInterestAverage">Net:</label>
        <div class="bg-[#008000]">
          {{ totals().netValue | currency }}
          <small>
            ({{ totals().net | currency }} -
            {{ totals().netPercentage | percent : ".1-3" }})</small
          >
        </div>
      </div>
      <div class="flex gap-1">
        <label for="startDate">Dates:</label>
        <div id="startDate" class="text-accent">
          {{ investment.startDate | date }} -
          {{ investment.dueDate | date }}
          <small
            >({{
              (investment.dueDate - todayDateTime) / (60e3 * 60 * 24)
                | number : ".0-0"
            }}
            days left)</small
          >
        </div>
      </div>
      <div class="flex gap-1">
        <label for="grossInterestAverage">Gross Interest Average:</label>
        <div class="text-accent">
          {{ averages().gross | percent : ".1-3" }}
        </div>
      </div>
      <div class="flex gap-1">
        <label for="netInterestAverage">Net Interest Average:</label>
        <div class="text-accent">
          {{ averages().net | percent : ".1-3" }}
        </div>
      </div>
      <div class="flex gap-1">
        <label for="netInterestAverage">Fees:</label>
        <div class="text-accent">
          {{ fees().fees | currency }}
          <small> ({{ fees().feesPercentage | percent : ".1-3" }})</small>
        </div>
      </div>
    </div>

    <div class="border-4 border-accent h-120">
      <app-chart [data]="chartData()" [title]="'Posição diária'"></app-chart>
    </div>

    <div class="flex flex-col gap-2 h-full overflow-auto">
      <a
        class="border py-1 px-3"
        *ngFor="
          let dailyPosition of investment.dailyPosition;
          trackBy: trackByFn
        "
        [routerLink]="['.', dailyPosition.id]"
      >
        <div class="flex gap-4 justify-between">
          <div class="grow flex flex-col">
            <div class="text-accent">{{ dailyPosition.date | date }}</div>

            <div class="flex flex-wrap md:gap-4">
              <div class="flex flex-wrap gap-4">
                <div class="flex gap-1">
                  Bruto:
                  <span class="text-accent">
                    {{ dailyPosition.grossValue | currency }}
                  </span>
                </div>
              </div>
              <div class="flex flex-wrap gap-4">
                <div class="flex gap-1">
                  Líquido:
                  <span class="text-accent">
                    {{ dailyPosition.netValue | currency }}
                  </span>
                </div>
              </div>
              <div class="flex flex-wrap gap-4">
                <div class="flex gap-1">
                  Lucro:
                  <span class="text-accent">
                    {{ dailyPosition.netValue - investment.value | currency }}
                    ({{
                      (dailyPosition.netValue - investment.value) /
                        investment.value | percent : ".1-3"
                    }})
                  </span>
                </div>
              </div>

              <div class="flex flex-wrap gap-4">
                <div class="flex gap-1">
                  IR:
                  <span class="text-accent">
                    {{ dailyPosition.IR | currency }} ({{
                      dailyPosition.IR / dailyPosition.netValue
                        | percent : ".1-3"
                    }})
                  </span>
                </div>
              </div>
              <div class="flex gap-4" *ngIf="dailyPosition.IOF">
                <div class="flex gap-4">
                  IOF:
                  <span class="text-accent">
                    {{ dailyPosition.IOF | currency }} ({{
                      dailyPosition.IOF /
                        (dailyPosition.grossValue - investment.value)
                        | percent : ".1-3"
                    }})
                  </span>
                </div>
              </div>
            </div>
          </div>
          <div class="flex items-center gap-2">
            <div>
              <button
                class="px-4"
                (click)="
                  $event.stopPropagation();
                  $event.preventDefault();
                  $event.preventDefault();
                  removeDailyPosition(investment.id, dailyPosition)
                "
              >
                x
              </button>
            </div>
          </div>
        </div>
      </a>
    </div>
  </div>
</app-page-wrapper>
